{
  "db_name": "PostgreSQL",
  "query": "\n            WITH locked AS (\n                SELECT * FROM task WHERE task_id = $1 AND attempt = $3 FOR UPDATE\n            ),\n            ins as (\n                INSERT INTO task_log(\n                    task_id,\n                    warehouse_id,\n                    queue_name,\n                    task_data,\n                    status,\n                    entity_id,\n                    entity_type,\n                    entity_name,\n                    message,\n                    attempt,\n                    started_at,\n                    duration,\n                    progress,\n                    execution_details,\n                    attempt_scheduled_for,\n                    last_heartbeat_at,\n                    parent_task_id,\n                    task_created_at\n                )\n                SELECT \n                    task_id,\n                    warehouse_id,\n                    queue_name,\n                    task_data,\n                    'failed',\n                    entity_id,\n                    entity_type,\n                    entity_name,\n                    $2,\n                    attempt,\n                    picked_up_at,\n                    now() - picked_up_at,\n                    progress,\n                    execution_details,\n                    scheduled_for,\n                    last_heartbeat_at,\n                    parent_task_id,\n                    created_at\n                FROM locked\n                ON CONFLICT (task_id, attempt) DO NOTHING\n            )\n            UPDATE task t\n            SET \n                status = 'scheduled',\n                progress = 0.0,\n                picked_up_at = NULL,\n                execution_details = NULL\n            FROM locked\n                WHERE t.task_id = locked.task_id AND t.attempt = locked.attempt\n            RETURNING t.task_id\n            ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "task_id",
        "type_info": "Uuid"
      }
    ],
    "parameters": {
      "Left": [
        "Uuid",
        "Text",
        "Int4"
      ]
    },
    "nullable": [
      false
    ]
  },
  "hash": "eb90b100455918b5d3cecf606bd61e506550a2f94c6e1ed80c70381d28b5cf92"
}
